- name: Ensure /etc/matrix-synapse/keys
  become: true
  file:
    state: directory
    path: /etc/matrix-synapse/keys

- name: Add secrets
  become: true
  copy:
    owner: matrix-synapse
    group: matrix-synapse
    content: |
      registration_shared_secret: "{{ synapse_registration_shared_secret }}"
      macaroon_secret_key: "{{ synapse_macaroon_secret_key }}"
      form_secret: "{{ synapse_form_secret }}"
    dest: /etc/matrix-synapse/secrets

- name: Add signing key
  become: true
  copy:
    owner: matrix-synapse
    group: matrix-synapse
    content: "{{ synapse_signing_key }}"
    dest: /etc/matrix-synapse/keys/vassast.org.signing.key
